<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dompet Masa Depan Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* BASE STYLES & OPTIMIZATION */
        body { font-family: 'Outfit', sans-serif; overflow-x: hidden; background-color: #0f172a; -webkit-tap-highlight-color: transparent; }
        [x-cloak] { display: none !important; }
        
        /* Optimized Glassmorphism (Kurangi blur di HP biar ringan) */
        .glass { background: rgba(17, 24, 39, 0.85); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        .glass-card { background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0)); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        @media (min-width: 768px) {
            .glass { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
            .glass-card { backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        }
        
        .h1-gradient { background: linear-gradient(to right, #818cf8, #e879f9, #22d3ee); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; } 
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; } 
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }

        /* ANIMATIONS (Hardware Accelerated) */
        .animate-gpu { transform: translateZ(0); will-change: transform; }

        @keyframes money-drop {
            0% { transform: translateX(-50%) translateY(-35px) scale(0.8) rotate(-10deg); opacity: 0; }
            20% { opacity: 1; transform: translateX(-50%) translateY(-20px) scale(1) rotate(0deg); }
            80% { opacity: 1; transform: translateX(-50%) translateY(5px) scale(0.6) rotate(10deg); }
            100% { transform: translateX(-50%) translateY(15px) scale(0.2); opacity: 0; }
        }
        @keyframes wallet-bounce {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.3)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 25px rgba(99, 102, 241, 0.6)); }
        }
        .animate-money { position: absolute; top: 0; left: 50%; animation: money-drop 1.2s infinite ease-in-out; z-index: 5; }
        .animate-wallet { position: relative; z-index: 10; animation: wallet-bounce 1.2s infinite ease-in-out; }
        .loader-bar { width: 100%; height: 4px; background: #1e293b; border-radius: 99px; overflow: hidden; position: relative; }
        .loader-bar::after { content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 0%; background: linear-gradient(90deg, #6366f1, #10b981, #06b6d4); animation: loading-progress 2s ease-in-out forwards; }
        @keyframes loading-progress { 0% { width: 0%; } 100% { width: 100%; } }

        /* PLANT GROWTH */
        @keyframes plant-grow { 0% { transform: scale(0) translateY(10px); opacity: 0; } 60% { transform: scale(1.2) translateY(-2px); opacity: 1; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
        @keyframes plant-sway { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
        .growing-plant { display: inline-block; animation: plant-grow 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards, plant-sway 3s ease-in-out infinite 0.8s; transform-origin: bottom center; }

        /* SKINS ID CARD */
        .skin-basic { background: #1e293b; border: 2px solid rgba(255,255,255,0.1); }
        .skin-tech { background-color: #0f172a; background-image: linear-gradient(rgba(59,130,246,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(59,130,246,0.1) 1px, transparent 1px); background-size: 20px 20px; border: 2px solid #3b82f6; box-shadow: 0 0 15px rgba(59,130,246,0.4); }
        .skin-carbon { background: repeating-linear-gradient(45deg, #1e1b4b, #1e1b4b 10px, #312e81 10px, #312e81 20px); border: 2px solid #6366f1; box-shadow: 0 0 20px rgba(99,102,241,0.4); }
        .skin-luxury { background: radial-gradient(circle, #7e22ce 0%, #3b0764 100%); border: 2px solid #a855f7; box-shadow: 0 0 25px rgba(168,85,247,0.5); }
        .skin-royal { background-color: #831843; background-image: radial-gradient(#db2777 15%, transparent 16%), radial-gradient(#db2777 15%, transparent 16%); background-size: 30px 30px; background-position: 0 0, 15px 15px; border: 2px solid #ec4899; box-shadow: 0 0 30px rgba(236,72,153,0.5); }
        .skin-sultan { background: linear-gradient(135deg, #78350f, #b45309, #f59e0b); border: 3px solid #fcd34d; box-shadow: 0 0 50px rgba(251,191,36,0.6); position: relative; overflow: hidden; }
        .skin-sultan::after { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(to bottom right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%); transform: rotate(45deg); animation: shimmer 2.5s infinite linear; pointer-events: none; }
        @keyframes shimmer { 0% { transform: translate(-30%, -30%) rotate(45deg); } 100% { transform: translate(30%, 30%) rotate(45deg); } }

        /* Physics CSS */
        #id-card-wrapper { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 150; pointer-events: none; }
        #id-card-container { position: absolute; top: 0; left: 0; width: 320px; height: 480px; cursor: grab; pointer-events: auto; touch-action: none; will-change: transform; }
        #id-card-container:active { cursor: grabbing; }
        .no-pointer { pointer-events: none; }
        #lanyard-svg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 140; }
        
        @media (max-width: 640px) { #id-card-container { width: 300px; height: 450px; } }
        input[type="file"]::file-selector-button { margin-right: 10px; background: #4f46e5; border: none; border-radius: 5px; color: white; padding: 5px 10px; cursor: pointer; font-size: 12px; }
        input[type="file"]::file-selector-button:hover { background: #4338ca; }
    </style>
</head>
<body class="bg-[#0f172a] text-white min-h-screen relative pb-20 md:pb-0" onload="initTime()">

    <div x-data="appData()" x-init="initApp()" class="min-h-screen">

        <div x-show="isLoading" x-transition.opacity.duration.1000ms class="fixed inset-0 z-[999] bg-[#0f172a] flex flex-col items-center justify-center p-4">
            <div class="relative w-32 h-32 mb-8 flex items-center justify-center animate-gpu">
                <i class="fas fa-money-bill-wave text-emerald-400 text-4xl animate-money"></i>
                <div class="relative z-10 bg-[#0f172a] rounded-full p-2">
                    <i class="fas fa-wallet text-6xl text-indigo-500 animate-wallet"></i>
                </div>
                <div class="absolute inset-0 bg-indigo-500 rounded-full blur-3xl opacity-20 animate-pulse z-0"></div>
            </div>
            <h1 class="text-3xl font-black h1-gradient mb-2 tracking-tight">Dompet Masa Depan</h1>
            <p class="text-gray-400 text-sm mb-8 font-mono tracking-widest flex items-center gap-2"><i class="fas fa-sync fa-spin text-xs"></i> MENYIAPKAN SALDO...</p>
            <div class="w-48 loader-bar shadow-[0_0_10px_rgba(99,102,241,0.5)]"></div>
            <p class="absolute bottom-10 text-xs text-gray-600">Powered by @er14ng45</p>
        </div>

        <div x-show="!isLoading && !userName" x-cloak class="fixed inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-md px-4">
            <div class="bg-gray-800 p-8 rounded-3xl text-center max-w-md w-full border border-gray-700">
                <div class="w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                    <i class="fas fa-wallet text-3xl"></i>
                </div>
                <h2 class="text-3xl font-bold mb-2">Selamat Datang!</h2>
                <p class="text-gray-400 mb-6 text-sm">Siapa nama panggilan kerenmu?</p>
                <input type="text" x-model="tempName" @keyup.enter="saveUser()" placeholder="Ketik nama..." class="w-full bg-gray-900 border border-gray-600 rounded-xl px-4 py-3 text-center text-white font-bold mb-4 focus:border-indigo-500 outline-none">
                <button @click="saveUser()" class="w-full bg-indigo-600 hover:bg-indigo-700 font-bold py-3 rounded-xl transition">Mulai Menabung</button>
            </div>
        </div>

        <div x-show="showArchive" x-cloak class="fixed inset-0 z-[180] flex items-center justify-center bg-black/80 backdrop-blur-sm px-4">
            <div class="glass p-6 rounded-3xl w-full max-w-lg relative border border-white/10" @click.outside="showArchive = false">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold flex items-center"><i class="fas fa-archive text-yellow-400 mr-2"></i> Arsip Target</h3>
                    <button @click="showArchive = false" class="text-gray-400 hover:text-white bg-white/5 rounded-full w-8 h-8 flex items-center justify-center"><i class="fas fa-times"></i></button>
                </div>
                <div class="space-y-4 overflow-y-auto max-h-[60vh] custom-scrollbar pr-2">
                    <template x-for="(arch, index) in archives" :key="index">
                        <div class="bg-gray-900/80 p-4 rounded-xl border border-gray-700/50 relative overflow-hidden group">
                            <div x-show="arch.image" class="absolute inset-0 z-0 opacity-20">
                                <img :src="arch.image" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition duration-500">
                                <div class="absolute inset-0 bg-gradient-to-r from-gray-900 to-transparent"></div>
                            </div>
                            <div class="relative z-10">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-bold text-lg text-white" x-text="arch.name"></h4>
                                    <button @click="generateArchivePDF(arch)" class="text-xs bg-indigo-500/20 hover:bg-indigo-500 text-indigo-300 hover:text-white border border-indigo-500/30 px-3 py-1.5 rounded-lg transition flex items-center gap-2"><i class="fas fa-file-pdf"></i> Unduh</button>
                                </div>
                                <div class="flex justify-between text-sm text-gray-400 mb-2">
                                    <span x-text="formatDate(arch.dateEnded)"></span>
                                    <span x-html="arch.status === 'success' ? '<span class=\'text-green-400 font-bold\'><i class=\'fas fa-check-circle\'></i> Tercapai</span>' : '<span class=\'text-gray-500 font-bold\'><i class=\'fas fa-stop-circle\'></i> Diganti</span>'"></span>
                                </div>
                                <div class="text-xs text-gray-500 text-right font-mono" x-text="'Akhir: Rp ' + formatRupiah(arch.finalBalance)"></div>
                            </div>
                        </div>
                    </template>
                    <div x-show="archives.length === 0" class="text-center text-gray-500 py-8 flex flex-col items-center">
                        <i class="fas fa-box-open text-3xl mb-2 opacity-50"></i>
                        <span>Belum ada sejarah masa lalu.</span>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="showIdCard" x-cloak class="fixed inset-0 z-[150]">
            <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="closeIdCard()"></div>
            <svg id="lanyard-svg"><line id="lanyard-line-shadow" stroke="rgba(0,0,0,0.5)" stroke-width="8"/><line id="lanyard-line" stroke="url(#g)" stroke-width="6"/><defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#374151"/><stop offset="1" stop-color="#4f46e5"/></linearGradient></defs></svg>
            <div id="id-card-wrapper"><div id="id-card-container">
                <div class="w-16 h-8 bg-gray-400 mx-auto -mt-4 rounded flex items-center justify-center shadow-lg border-b-2 border-gray-600 relative z-20 no-pointer"><div class="text-[8px] text-gray-800 font-bold tracking-widest">SECURE</div></div>
                <div :class="`tilt-card ${currentSkin} w-full h-full rounded-3xl shadow-2xl relative overflow-hidden flex flex-col items-center text-center -mt-2 animate-gpu`">
                    <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 mix-blend-overlay no-pointer"></div>
                    <div class="absolute top-0 w-full h-40 bg-gradient-to-b from-white/10 to-transparent no-pointer"></div>
                    <div class="w-28 h-28 rounded-full bg-black/30 border-4 border-white/20 flex items-center justify-center shadow-xl relative z-10 mt-10 mb-4 no-pointer backdrop-blur-sm"><i class="fas fa-user-secret text-6xl text-white/80"></i></div>
                    <div class="relative z-10 px-4 w-full no-pointer"><h2 class="text-3xl font-black text-white uppercase tracking-wider drop-shadow-md break-words leading-tight" x-text="userName"></h2><div class="mt-2 flex justify-center"><span class="bg-black/30 text-white/80 text-xs px-4 py-1 rounded-full border border-white/20 font-mono backdrop-blur-md" x-text="'ID: ' + rankCode + '-' + Math.floor(Math.random()*9000+1000)"></span></div></div>
                    <div class="grid grid-cols-2 gap-3 w-full px-6 mt-6 relative z-10 no-pointer">
                        <div class="bg-black/20 p-3 rounded-xl border border-white/10 backdrop-blur-md"><p class="text-[10px] text-white/60 uppercase font-bold">Rank</p><p class="text-lg font-bold text-white" x-text="currentLevel"></p></div>
                        <div class="bg-black/20 p-3 rounded-xl border border-white/10 backdrop-blur-md"><p class="text-[10px] text-white/60 uppercase font-bold">Gabung</p><p class="text-sm font-bold text-white mt-1" x-text="joinDate"></p></div>
                        <div class="col-span-2 bg-black/20 p-3 rounded-xl border border-white/10 backdrop-blur-md"><p class="text-[10px] text-emerald-300 uppercase font-bold">Saldo</p><p class="text-2xl font-black text-emerald-400" x-text="'Rp ' + formatRupiah(totalSaved)"></p></div>
                    </div>
                    <div class="mt-auto mb-6 w-full px-6 opacity-60 no-pointer"><div class="h-8 bg-white w-full rounded-sm" style="background-image: repeating-linear-gradient(90deg, #000 0px, #000 2px, transparent 2px, transparent 4px);"></div></div>
                </div>
                <p class="text-center text-white/50 mt-4 text-xs no-pointer animate-pulse">Tarik aku!</p>
            </div></div>
        </div>

        <div class="container mx-auto px-4 py-8 max-w-7xl">
            <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <div class="w-full md:w-auto">
                    <div class="flex items-center gap-2 mb-1 justify-center md:justify-start">
                        <span class="bg-indigo-500/20 text-indigo-300 text-xs px-2 py-1 rounded border border-indigo-500/30"><i class="fas fa-calendar-alt mr-2"></i><span id="liveDate">...</span></span>
                        <span id="liveClock" class="bg-pink-500/20 text-pink-300 text-xs px-2 py-1 rounded border border-pink-500/30 font-mono">...</span>
                    </div>
                    <h1 class="text-3xl md:text-4xl font-extrabold h1-gradient text-center md:text-left">Halo, <span x-text="userName"></span>! üëã</h1>
                    
                    <div class="mt-3 hidden md:flex items-center gap-2">
                        <button @click="openIdCard()" class="text-xs bg-indigo-600/20 hover:bg-indigo-600/40 text-indigo-300 px-3 py-1.5 rounded-full border border-indigo-500/30 flex items-center gap-2 transition hover:-translate-y-1"><i class="fas fa-id-card"></i> Lihat ID Card</button>
                        <button @click="changeName()" class="text-xs bg-gray-700/50 hover:bg-gray-700 text-white px-3 py-1.5 rounded-full border border-gray-600 flex items-center gap-2 transition hover:-translate-y-1"><i class="fas fa-pencil-alt"></i> Ganti Nama</button>
                        <button @click="showArchive = true" class="text-xs bg-yellow-600/20 hover:bg-yellow-600/40 text-yellow-300 px-3 py-1.5 rounded-full border border-yellow-500/30 flex items-center gap-2 transition hover:-translate-y-1"><i class="fas fa-archive"></i> Riwayat</button>
                    </div>
                </div>
                
                <template x-if="target">
                    <div :class="`glass px-4 md:px-6 py-3 rounded-2xl flex items-center gap-4 border-l-4 border-${badgeColor}-500 w-full md:w-auto justify-between md:justify-end animate-gpu`">
                        <div class="text-right">
                            <p class="text-[10px] uppercase text-gray-400">Status Tanaman</p>
                            <p :class="`text-lg md:text-xl font-bold text-${badgeColor}-400`" x-text="currentLevel"></p>
                        </div>
                        <div class="w-14 h-14 rounded-full bg-gray-800 flex items-center justify-center text-3xl shadow-lg border border-gray-700 relative overflow-hidden">
                            <span x-text="levelIcon" class="growing-plant"></span>
                        </div>
                    </div>
                </template>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 relative z-10">
                <div class="lg:col-span-8 space-y-6">
                    
                    <div class="glass-card rounded-3xl p-6 md:p-8 relative overflow-hidden group">
                        <template x-if="target && target.image">
                            <div class="absolute inset-0 z-0">
                                <img :src="target.image" class="w-full h-full object-cover opacity-30 group-hover:opacity-40 transition duration-700 filter blur-sm group-hover:blur-0 transform scale-105 group-hover:scale-100">
                                <div class="absolute inset-0 bg-gradient-to-r from-gray-900 via-gray-900/80 to-transparent"></div>
                            </div>
                        </template>
                        <div x-show="!target || !target.image" class="absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-indigo-600/10 to-purple-600/10 rounded-full blur-[80px] -z-10"></div>
                        
                        <div class="relative z-10">
                            <template x-if="target">
                                <div>
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6 gap-2">
                                        <div><span class="text-[10px] uppercase text-indigo-300 font-bold tracking-wider">Misi Utama</span><h2 class="text-3xl md:text-4xl font-black text-white leading-tight drop-shadow-md" x-text="target.name"></h2></div>
                                        <div class="text-left md:text-right bg-black/40 p-3 rounded-xl border border-white/5 backdrop-blur-md"><span class="text-[10px] text-gray-300 uppercase">Terkumpul</span><p class="text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-300" x-text="'Rp ' + formatRupiah(totalSaved)"></p></div>
                                    </div>
                                    <div class="w-full h-5 bg-gray-900/50 rounded-full mb-8 border border-gray-700/50 p-0.5 shadow-inner">
                                        <div class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-full flex items-center justify-end pr-2 transition-all duration-1000 shadow-[0_0_15px_rgba(99,102,241,0.5)]" :style="`width: ${percentage}%`">
                                            <span class="text-[9px] font-black text-white" x-text="percentage + '%'"></span>
                                        </div>
                                    </div>
                                    <div class="bg-gray-900/60 rounded-2xl p-4 border border-gray-700/30 mb-6 backdrop-blur-md relative h-[250px]">
                                        <canvas id="savingsChart"></canvas>
                                    </div>
                                    <div class="bg-indigo-900/40 border border-indigo-500/20 p-4 rounded-xl flex items-start gap-3 backdrop-blur-md">
                                        <div class="bg-indigo-500/20 p-2 rounded-full flex-shrink-0"><i class="fas fa-robot text-indigo-300"></i></div>
                                        <p class="text-sm text-indigo-100 leading-relaxed" x-html="predictionMsg"></p>
                                    </div>
                                </div>
                            </template>

                            <template x-if="!target">
                                <div class="text-center py-20">
                                    <div class="bg-gray-800/50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 border border-gray-700 animate-pulse"><i class="fas fa-wallet text-4xl text-gray-500"></i></div>
                                    <h3 class="text-2xl font-bold">Dompet Kosong</h3>
                                    <p class="text-gray-400 mt-2 text-sm">Buat target baru di panel kanan untuk memulai.</p>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div class="glass rounded-3xl p-6 relative z-10">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                            <h3 class="font-bold flex items-center text-lg"><i class="fas fa-history text-indigo-400 mr-2"></i>Aktivitas</h3>
                            <div class="flex gap-2 w-full sm:w-auto">
                                <button @click="confirmClearAll()" class="flex-1 sm:flex-none text-xs bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white border border-red-500/30 px-3 py-2 rounded-lg transition flex justify-center gap-2 items-center"><i class="fas fa-trash-alt"></i> Reset</button>
                                <button @click="generateCurrentPDF()" class="flex-1 sm:flex-none text-xs bg-white/5 hover:bg-white/10 border border-white/10 px-4 py-2 rounded-lg flex justify-center gap-2 items-center text-indigo-400"><i class="fas fa-download"></i> PDF</button>
                            </div>
                        </div>
                        <div class="space-y-3 overflow-y-auto max-h-[350px] custom-scrollbar pr-2">
                            <template x-for="trx in transactions" :key="trx.id">
                                <div class="flex justify-between items-center p-4 rounded-2xl bg-gray-900/30 hover:bg-white/5 transition group border border-transparent hover:border-white/10">
                                    <div class="flex items-center gap-4">
                                        <div :class="`w-10 h-10 md:w-12 md:h-12 rounded-2xl flex items-center justify-center shadow-lg flex-shrink-0 ${trx.type=='in'?'bg-emerald-500/10 text-emerald-400':'bg-rose-500/10 text-rose-400'}`"><i :class="`fas ${trx.type=='in'?'fa-arrow-down':'fa-arrow-up'}`"></i></div>
                                        <div><p class="font-bold text-sm text-white" x-text="trx.desc"></p><p class="text-[10px] uppercase text-gray-500" x-text="formatDateFull(trx.date)"></p></div>
                                    </div>
                                    <div class="flex items-center gap-2 md:gap-4">
                                        <span :class="`font-mono font-black text-sm md:text-lg ${trx.type=='in'?'text-emerald-400':'text-rose-400'}`" x-text="(trx.type=='in'?'+':'-') + ' ' + formatRupiah(trx.amount)"></span>
                                        <button @click="deleteTrx(trx.id)" class="w-8 h-8 rounded-full hover:bg-red-500 text-gray-600 hover:text-white flex items-center justify-center transition opacity-100 md:opacity-0 md:group-hover:opacity-100"><i class="fas fa-trash text-xs"></i></button>
                                    </div>
                                </div>
                            </template>
                            <div x-show="transactions.length === 0" class="text-center text-gray-500 py-8 text-sm">Belum ada transaksi saat ini.</div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-4 space-y-6">
                    <div x-show="target" class="glass rounded-3xl p-6 border-t-4 border-indigo-500 shadow-2xl relative">
                        <h3 class="font-bold mb-6 flex items-center"><i class="fas fa-bolt text-yellow-400 mr-2"></i>Aksi Cepat</h3>
                        <div class="flex bg-gray-900/70 p-1.5 rounded-2xl mb-6"><button @click="trxType='in'" :class="trxType=='in'?'bg-emerald-600 text-white':'text-gray-500'" class="flex-1 py-3 rounded-xl text-sm font-bold transition">Nabung</button><button @click="trxType='out'" :class="trxType=='out'?'bg-rose-600 text-white':'text-gray-500'" class="flex-1 py-3 rounded-xl text-sm font-bold transition">Tarik</button></div>
                        <div class="space-y-5">
                            <div><label class="text-[10px] uppercase text-gray-400 font-bold mb-2 block ml-1">Nominal</label><div class="relative"><span class="absolute left-4 top-4 text-gray-500 font-bold">Rp</span><input type="text" x-model="trxAmount" @input="formatInput($event)" class="w-full bg-gray-900/50 border border-gray-700 rounded-xl pl-12 pr-4 py-3.5 text-2xl font-black focus:border-indigo-500 outline-none font-mono text-white" placeholder="0"></div></div>
                            <div><label class="text-[10px] uppercase text-gray-400 font-bold mb-2 block ml-1">Keterangan</label><input type="text" x-model="trxDesc" class="w-full bg-gray-900/50 border border-gray-700 rounded-xl px-4 py-3 text-sm focus:border-indigo-500 outline-none text-white" placeholder="Contoh: Sisa jajan"></div>
                            <button @click="saveTransaction()" :class="trxType=='in'?'bg-gradient-to-r from-emerald-500 to-teal-600':'bg-gradient-to-r from-rose-500 to-red-600'" class="w-full py-4 rounded-xl font-bold shadow-lg transform active:scale-95 transition text-lg text-white"><span x-text="trxType=='in'?'Simpan Uang':'Ambil Uang'"></span></button>
                        </div>
                    </div>
                    
                    <div class="glass rounded-3xl p-6 border-t-4 border-purple-500">
                         <h3 class="font-bold mb-6 flex items-center"><i class="fas fa-rocket text-purple-400 mr-2"></i><span x-text="target ? 'Ganti Target' : 'Target Baru'"></span></h3>
                         <p class="text-xs text-gray-400 mb-4 bg-gray-800/50 p-2 rounded border border-gray-700">*Target baru akan mereset saldo ke 0. Target lama masuk arsip.</p>
                         <div class="space-y-4">
                            <div><label class="text-[10px] uppercase text-gray-500 font-bold mb-1 ml-1">Nama Barang</label><input type="text" x-model="newTargetName" placeholder="Misal: iPhone 15" class="w-full bg-gray-900/50 border border-gray-700 rounded-xl px-4 py-2.5 text-sm outline-none focus:border-purple-500 text-white"></div>
                            <div><label class="text-[10px] uppercase text-gray-500 font-bold mb-1 ml-1">Harga (Rp)</label><div class="relative"><span class="absolute left-4 top-2.5 text-gray-500 text-xs font-bold">Rp</span><input type="text" x-model="newTargetAmount" @input="formatInput($event)" class="w-full bg-gray-900/50 border border-gray-700 rounded-xl pl-10 pr-4 py-2.5 text-sm outline-none font-mono focus:border-purple-500 text-white"></div></div>
                            <div><label class="text-[10px] uppercase text-gray-500 font-bold mb-1 ml-1 flex justify-between"><span>Foto Barang</span> <span class="text-purple-400 text-[9px] italic">JPG, PNG (Max 500KB)</span></label><input type="file" @change="handleImageUpload($event)" accept="image/*" class="w-full bg-gray-900/50 border border-gray-700 rounded-xl px-2 py-2 text-xs text-gray-300"><template x-if="newTargetImage"><div class="mt-2 w-full h-32 rounded-lg overflow-hidden border border-gray-700 relative"><img :src="newTargetImage" class="w-full h-full object-cover"><button @click="newTargetImage = ''; document.querySelector('input[type=file]').value = '';" class="absolute top-1 right-1 bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs"><i class="fas fa-times"></i></button></div></template></div>
                            <div class="p-4 bg-purple-900/20 rounded-2xl border border-purple-500/20 mt-2"><label class="text-[10px] uppercase text-purple-300 font-bold mb-2 block">Komitmen Rutin</label><div class="flex gap-2"><div class="relative w-2/3"><span class="absolute left-3 top-2.5 text-purple-300/50 text-xs font-bold">Rp</span><input type="text" x-model="newTargetPlan" @input="formatInput($event)" class="w-full bg-gray-900/80 border border-purple-500/30 rounded-xl pl-9 pr-3 py-2.5 text-sm outline-none font-mono text-white"></div><select x-model="newTargetFreq" class="w-1/3 bg-gray-900/80 border border-purple-500/30 rounded-xl px-2 py-2.5 text-xs outline-none text-white"><option value="daily">Harian</option><option value="weekly">Mingguan</option><option value="monthly">Bulanan</option></select></div></div>
                            <button @click="saveTarget()" class="w-full bg-gray-800 hover:bg-purple-600 text-white py-3 rounded-xl text-sm font-bold transition mt-4 shadow-lg"><i class="fas fa-lock mr-2"></i>Kunci Target</button>
                         </div>
                    </div>
                </div>
            </div>
            
            <footer class="mt-16 text-center text-gray-500 text-xs border-t border-gray-800 pt-8 pb-8">
                <p class="mb-2">&copy; 2026 DompetMasaDepan Pro.</p>
                <p>Developed with ‚ù§Ô∏è by <a href="https://instagram.com/er14ng45" target="_blank" class="text-indigo-400 hover:text-indigo-300 font-bold underline decoration-indigo-500/30">@er14ng45</a></p>
            </footer>
        </div>

        <div class="fixed bottom-6 right-6 z-[100] md:hidden">
            <div x-data="{ open: false }" class="relative">
                <div x-show="open" x-transition.opacity class="absolute bottom-16 right-0 flex flex-col gap-3 items-end min-w-[150px]">
                    <button @click="openIdCard(); open=false" class="bg-indigo-600 text-white text-xs px-4 py-2 rounded-full shadow-lg flex items-center gap-2">Lihat ID Card <i class="fas fa-id-card"></i></button>
                    <button @click="changeName(); open=false" class="bg-gray-700 text-white text-xs px-4 py-2 rounded-full shadow-lg flex items-center gap-2">Ganti Nama <i class="fas fa-pencil-alt"></i></button>
                    <button @click="showArchive=true; open=false" class="bg-yellow-600 text-white text-xs px-4 py-2 rounded-full shadow-lg flex items-center gap-2">Riwayat <i class="fas fa-archive"></i></button>
                </div>
                <button @click="open = !open" class="w-14 h-14 bg-indigo-600 text-white rounded-full shadow-2xl flex items-center justify-center text-xl border-2 border-indigo-400 transform transition active:scale-90"><i class="fas" :class="open ? 'fa-times' : 'fa-bars'"></i></button>
            </div>
        </div>
    </div>

    <script>
        function appData() {
            return {
                isLoading: true, userName: localStorage.getItem('dompetUser'), tempName: '',
                target: JSON.parse(localStorage.getItem('dompetTarget')) || null,
                transactions: JSON.parse(localStorage.getItem('dompetTrx')) || [],
                archives: JSON.parse(localStorage.getItem('dompetArchives')) || [],
                joinDate: localStorage.getItem('dompetJoinDate') || new Date().toLocaleDateString('id-ID', {day:'numeric', month:'long', year:'numeric'}),
                showIdCard: false, showArchive: false, trxType: 'in', trxAmount: '', trxDesc: '',
                newTargetName: '', newTargetAmount: '', newTargetPlan: '', newTargetFreq: 'daily', newTargetImage: '',
                
                get totalSaved() { return this.transactions.reduce((acc, t) => t.type === 'in' ? acc + t.amount : acc - t.amount, 0); },
                get percentage() { if(!this.target || this.target.amount <= 0) return 0; return Math.min(100, (this.totalSaved / this.target.amount) * 100).toFixed(1); },
                get currentLevel() { const p = parseFloat(this.percentage); if(p >= 100) return 'Panen Raya'; if(p >= 75) return 'Mekar Indah'; if(p >= 50) return 'Kuncup Bunga'; if(p >= 25) return 'Tanaman Pot'; if(p >= 10) return 'Tunas Muda'; return 'Benih Baru'; },
                get levelIcon() { const p = parseFloat(this.percentage); if(p >= 100) return 'üåª'; if(p >= 75) return 'üå∫'; if(p >= 50) return 'üå∑'; if(p >= 25) return 'ü™¥'; if(p >= 10) return 'üåø'; return 'üå±'; },
                get currentSkin() { const p = parseFloat(this.percentage); if(p >= 100) return 'skin-sultan'; if(p >= 75) return 'skin-royal'; if(p >= 50) return 'skin-luxury'; if(p >= 25) return 'skin-carbon'; if(p >= 10) return 'skin-tech'; return 'skin-basic'; },
                get rankCode() { const p = parseFloat(this.percentage); if(p >= 100) return 'MAX'; if(p >= 75) return 'ELT'; if(p >= 50) return 'PRO'; if(p >= 25) return 'ADV'; if(p >= 10) return 'INT'; return 'NOV'; },
                get badgeColor() { const p = parseFloat(this.percentage); if(p >= 100) return 'yellow'; if(p >= 75) return 'pink'; if(p >= 50) return 'purple'; if(p >= 25) return 'indigo'; if(p >= 10) return 'blue'; return 'gray'; },
                
                get predictionMsg() {
                    if(!this.target) return 'Silakan buat target baru.';
                    if(this.totalSaved >= this.target.amount) return 'üéâ SELAMAT! Target tercapai!';
                    const remaining = this.target.amount - this.totalSaved;
                    let dailyRate = 0, label = '';
                    if(this.target.freq == 'daily') { dailyRate = this.target.plan; label = 'hari'; } else if(this.target.freq == 'weekly') { dailyRate = this.target.plan/7; label = 'minggu'; } else { dailyRate = this.target.plan/30; label = 'bulan'; }
                    if(dailyRate <= 0) return 'Mulai menabung untuk melihat prediksi.';
                    const daysLeft = Math.ceil(remaining / dailyRate);
                    return `Dengan konsisten nabung <b>Rp ${this.formatRupiah(this.target.plan)} per ${label}</b>, selesai dalam <b>¬±${daysLeft} hari</b>.`;
                },

                initApp() {
                    if(!localStorage.getItem('dompetJoinDate')) localStorage.setItem('dompetJoinDate', this.joinDate);
                    setTimeout(() => { this.isLoading = false; setTimeout(() => { this.updateChart(); }, 500); }, 2500);
                    this.$watch('transactions', () => this.updateChart());
                },
                
                // --- FIX: GENERATE PDF LOGIC (Status + Empty Fix) ---
                generateCurrentPDF() { 
                    // Gunakan "Masih Progres" untuk riwayat aktif
                    this.printPDF(this.transactions, this.target ? this.target.name : 'Target Aktif', 'Masih Progres'); 
                },
                generateArchivePDF(arch) { 
                    // Gunakan "Sudah Selesai" untuk arsip
                    this.printPDF(arch.transactions, arch.name, 'Sudah Selesai'); 
                },
                
                printPDF(dataRaw, title, status) {
                    // DEEP COPY untuk menghindari error Proxy/Array kosong di Alpine
                    const data = JSON.parse(JSON.stringify(dataRaw)); 
                    const totalIn = data.reduce((acc,t)=>t.type=='in'?acc+t.amount:acc,0);
                    const totalOut = data.reduce((acc,t)=>t.type=='out'?acc+t.amount:acc,0);
                    const statusColor = status === 'Sudah Selesai' ? 'green' : '#eab308'; // Hijau atau Kuning

                    // Jika data kosong, beri pesan
                    let tableContent = '';
                    if (data.length === 0) {
                        tableContent = `<tr><td colspan="4" style="padding:20px; text-align:center; color:#888;">Belum ada transaksi tercatat.</td></tr>`;
                    } else {
                        tableContent = data.map(t => `
                            <tr style="border-bottom:1px solid #eee;">
                                <td style="padding:8px;">${new Date(t.date).toLocaleDateString('id-ID')}</td>
                                <td style="padding:8px;">${t.desc}</td>
                                <td style="padding:8px; font-weight:bold; color:${t.type=='in'?'green':'red'};">${t.type=='in'?'MASUK':'KELUAR'}</td>
                                <td style="padding:8px; text-align:right;">Rp ${this.formatRupiah(t.amount)}</td>
                            </tr>
                        `).join('');
                    }

                    let html = `
                    <div style="font-family:sans-serif; padding:20px; color:#333; width:100%;">
                        <h1 style="text-align:center; border-bottom:2px solid #333; padding-bottom:10px; margin-bottom:5px;">Laporan: ${title}</h1>
                        
                        <div style="text-align:center; margin-bottom:20px;">
                            <p style="margin:0; color:#666;">Dicetak: ${new Date().toLocaleString('id-ID')}</p>
                            <div style="margin-top:10px; padding:5px 15px; border:2px solid ${statusColor}; color:${statusColor}; display:inline-block; font-weight:bold; border-radius:5px; text-transform:uppercase;">
                                STATUS: ${status}
                            </div>
                        </div>

                        <table style="width:100%; margin:20px 0; border-collapse:collapse; text-align:center;">
                            <tr style="background:#f3f4f6;">
                                <td style="padding:10px; border:1px solid #ddd;">Total Masuk<br><b style="color:green; font-size:16px;">Rp ${this.formatRupiah(totalIn)}</b></td>
                                <td style="padding:10px; border:1px solid #ddd;">Total Keluar<br><b style="color:red; font-size:16px;">Rp ${this.formatRupiah(totalOut)}</b></td>
                                <td style="padding:10px; border:1px solid #ddd;">Saldo Akhir<br><b style="color:blue; font-size:16px;">Rp ${this.formatRupiah(totalIn - totalOut)}</b></td>
                            </tr>
                        </table>

                        <h3 style="margin-top:20px; font-size:14px;">Rincian Transaksi:</h3>
                        <table style="width:100%; border-collapse:collapse; font-size:12px; border:1px solid #eee;">
                            <thead>
                                <tr style="background:#333; color:#fff;">
                                    <th style="padding:8px; text-align:left;">Tanggal</th>
                                    <th style="padding:8px; text-align:left;">Ket</th>
                                    <th style="padding:8px; text-align:left;">Tipe</th>
                                    <th style="text-align:right; padding:8px;">Nominal</th>
                                </tr>
                            </thead>
                            <tbody>${tableContent}</tbody>
                        </table>
                        
                        <div style="margin-top:30px; text-align:center; font-size:10px; color:#aaa;">
                            Generated by Dompet Masa Depan Pro
                        </div>
                    </div>`;

                    // Generate PDF dengan Opsi Hemat Resource
                    html2pdf().from(html).set({ 
                        margin: 10, 
                        filename: `Laporan-${title}.pdf`, 
                        html2canvas: { scale: 2, useCORS: true }, 
                        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                        enableLinks: false // Optimasi performa
                    }).save();
                },

                // --- DATA HANDLING ---
                saveUser() { if(!this.tempName) this.tempName = 'Bos'; this.userName = this.tempName; localStorage.setItem('dompetUser', this.userName); Swal.fire({icon:'success', title:'Halo, '+this.userName, background:'#1e293b', color:'#fff', showConfirmButton:false, timer:1500}); },
                changeName() { Swal.fire({title:'Ganti Nama', input:'text', inputValue:this.userName, background:'#1e293b', color:'#fff', confirmButtonText:'Simpan'}).then(r => { if(r.isConfirmed && r.value) { this.userName = r.value; localStorage.setItem('dompetUser', this.userName); } }); },
                formatInput(e) { e.target.value = this.formatRupiah(e.target.value.replace(/[^0-9]/g, '')); },
                formatRupiah(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); },
                unformatRupiah(n) { return parseInt(n.replace(/[^0-9]/g, '')) || 0; },
                formatDateFull(d) { return new Date(d).toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'}) + ' WIB'; },
                formatDate(d) { return new Date(d).toLocaleDateString('id-ID', {day:'numeric', month:'short', year:'numeric'}); },
                handleImageUpload(event) { const file = event.target.files[0]; if (!file) return; if (file.size > 500 * 1024) { Swal.fire({icon: 'error', title: 'File Terlalu Besar!', text: 'Maksimal 500KB.', background: '#1e293b', color: '#fff'}); event.target.value = ''; return; } const reader = new FileReader(); reader.onload = (e) => { this.newTargetImage = e.target.result; }; reader.readAsDataURL(file); },

                saveTarget() {
                    if(!this.newTargetName || !this.newTargetAmount) return;
                    if(this.target) {
                        this.archives.unshift({ name: this.target.name, amount: this.target.amount, dateEnded: new Date(), status: this.totalSaved >= this.target.amount ? 'success' : 'replaced', finalBalance: this.totalSaved, image: this.target.image, transactions: [...this.transactions] });
                        localStorage.setItem('dompetArchives', JSON.stringify(this.archives));
                    }
                    this.target = { name: this.newTargetName, amount: this.unformatRupiah(this.newTargetAmount), plan: this.unformatRupiah(this.newTargetPlan), freq: this.newTargetFreq, image: this.newTargetImage, dateCreated: new Date() };
                    this.transactions = []; localStorage.setItem('dompetTarget', JSON.stringify(this.target)); localStorage.setItem('dompetTrx', JSON.stringify(this.transactions));
                    this.newTargetName = ''; this.newTargetAmount = ''; this.newTargetPlan = ''; this.newTargetImage = ''; const fileInput = document.querySelector('input[type="file"]'); if(fileInput) fileInput.value = '';
                    Swal.fire({icon:'success', title:'Target Baru!', background:'#1e293b', color:'#fff'}); setTimeout(() => this.updateChart(), 100);
                },

                saveTransaction() {
                    const amount = this.unformatRupiah(this.trxAmount); if(amount <= 0 || !this.trxDesc) return;
                    if(this.trxType === 'out') {
                        if(amount > this.totalSaved) return Swal.fire({icon:'error', title:'Saldo Kurang!', background:'#1e293b', color:'#fff'});
                        return Swal.fire({ title: 'üö® POLISI TABUNGAN!', html: `<p class="mb-2">Yakin ambil tabungan?</p>`, icon: 'warning', background: '#1e293b', color: '#fff', showCancelButton: true, confirmButtonText: 'Tunggu (5)', confirmButtonColor: '#ef4444', didOpen: () => { Swal.showLoading(); const b = Swal.getConfirmButton(); b.setAttribute('disabled',''); let t=5; const i=setInterval(()=>{ t--; b.innerText=`Yakin? (${t})`; if(t<=0){ clearInterval(i); Swal.hideLoading(); b.removeAttribute('disabled'); b.innerText='Gas Tarik'; } },1000); } }).then(r => { if(r.isConfirmed) this.commitTransaction(amount); });
                    }
                    this.commitTransaction(amount);
                    Swal.fire({icon:'success', title:'Masuk!', background:'#1e293b', color:'#fff', showConfirmButton:false, timer:1500}); confetti({particleCount:100, spread:70, origin:{y:0.6}});
                },
                commitTransaction(amt) { this.transactions.unshift({ id: Date.now(), type: this.trxType, amount: amt, desc: this.trxDesc, date: new Date() }); localStorage.setItem('dompetTrx', JSON.stringify(this.transactions)); this.trxAmount = ''; this.trxDesc = ''; },
                deleteTrx(id) { Swal.fire({title:'Hapus?', icon:'warning', showCancelButton:true, confirmButtonColor:'#ef4444', background:'#1e293b', color:'#fff'}).then(r => { if(r.isConfirmed) { this.transactions = this.transactions.filter(t => t.id !== id); localStorage.setItem('dompetTrx', JSON.stringify(this.transactions)); } }); },
                confirmClearAll() { Swal.fire({title:'Reset?', text:'Data hilang!', icon:'warning', showCancelButton:true, confirmButtonColor:'#ef4444', background:'#1e293b', color:'#fff'}).then(r => { if(r.isConfirmed) { this.transactions = []; localStorage.setItem('dompetTrx', JSON.stringify(this.transactions)); Swal.fire({icon:'success', title:'Bersih!', background:'#1e293b', color:'#fff'}); } }); },
                
                updateChart() {
                    const ctx = document.getElementById('savingsChart'); if(!ctx) return;
                    const sorted = [...this.transactions].sort((a,b) => new Date(a.date) - new Date(b.date));
                    const labels = sorted.map(t => new Date(t.date).toLocaleDateString('id-ID', {day:'numeric', month:'short'}));
                    let running = 0; const data = sorted.map(t => { if(t.type=='in') running+=t.amount; else running-=t.amount; return running; });
                    if(window.myChart) { window.myChart.destroy(); }
                    const grad = ctx.getContext('2d').createLinearGradient(0,0,0,200); grad.addColorStop(0,'rgba(99,102,241,0.2)'); grad.addColorStop(1,'rgba(99,102,241,0)');
                    window.myChart = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [{ label: 'Saldo', data: data, borderColor: '#818cf8', backgroundColor: grad, borderWidth: 3, tension: 0.4, fill: true, pointBackgroundColor: '#4f46e5' }] }, options: { responsive: true, maintainAspectRatio: false, animation: { duration: 1000 }, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false }, ticks: { color: '#64748b' } }, y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' } } } } });
                },

                // --- OPTIMIZED PHYSICS (Hanya jalan saat ID Card dibuka) ---
                openIdCard() { 
                    this.showIdCard=true; 
                    setTimeout(()=>{
                        initPhysicsSystem(); 
                        setupDragEvents(); 
                        VanillaTilt.init(document.querySelector('.tilt-card'),{max:10,speed:400,glare:true,'max-glare':0.2});
                    },50); 
                },
                closeIdCard() { 
                    this.showIdCard=false; 
                    cancelAnimationFrame(physicsLoop); // MATIKAN LOOP ANIMASI (HEMAT BATERAI)
                }
            }
        }
        function initTime() { const update = () => { const now = new Date(); document.getElementById('liveClock').innerText = now.toLocaleTimeString('id-ID').replace(/\./g, ':') + ' WIB'; document.getElementById('liveDate').innerText = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }); }; update(); setInterval(update, 1000); }
        
        // --- PHYSICS SYSTEM (Optimized) ---
        let physicsLoop, isDragging = false, currentPos = {x:0, y:0}, targetPos = {x:0, y:0}, velocity = {x:0, y:0}, dragOffset = {x:0, y:0};
        const cardWidth = 320, cardHeight = 480;
        function initPhysicsSystem() { 
            const el = document.getElementById('id-card-container'); if(!el) return; 
            currentPos = {x:window.innerWidth/2, y:window.innerHeight/2}; targetPos = {...currentPos}; velocity={x:0,y:0}; 
            if(physicsLoop) cancelAnimationFrame(physicsLoop); 
            animatePhysics(); 
        }
        function animatePhysics() { 
            const card = document.getElementById('id-card-container'); if(!card) return; // Stop if element missing
            const l1 = document.getElementById('lanyard-line'); const l2 = document.getElementById('lanyard-line-shadow'); 
            const spring=0.08, friction=0.82; 
            if(!isDragging) { targetPos.x = window.innerWidth/2; targetPos.y = window.innerHeight/2; } 
            velocity.x += (targetPos.x - currentPos.x)*spring; velocity.y += (targetPos.y - currentPos.y)*spring; 
            velocity.x *= friction; velocity.y *= friction; 
            currentPos.x += velocity.x; currentPos.y += velocity.y; 
            
            // Apply Transform
            const renderX = currentPos.x - (cardWidth / 2); 
            const renderY = currentPos.y - (cardHeight / 2); 
            const rotateDeg = velocity.x * 0.4; 
            card.style.transform = `translate(${renderX}px, ${renderY}px) rotate(${rotateDeg}deg)`; 
            
            // Draw SVG Lines only if needed
            if(l1 && l2) {
                [l1, l2].forEach(l => { 
                    l.setAttribute('x1', window.innerWidth/2); l.setAttribute('y1', -20); 
                    l.setAttribute('x2', currentPos.x); l.setAttribute('y2', currentPos.y - cardHeight/2 + 10); 
                }); 
            }
            physicsLoop = requestAnimationFrame(animatePhysics); 
        }
        function setupDragEvents() { const card = document.getElementById('id-card-container'); const start = (e) => { isDragging=true; const p = e.touches ? e.touches[0] : e; dragOffset.x = p.clientX - currentPos.x; dragOffset.y = p.clientY - currentPos.y; card.style.cursor='grabbing'; }; const move = (e) => { if(!isDragging) return; const p = e.touches ? e.touches[0] : e; targetPos.x = p.clientX - dragOffset.x; targetPos.y = p.clientY - dragOffset.y; }; const end = () => { isDragging=false; if(card) card.style.cursor='grab'; }; if(card) { card.addEventListener('mousedown', start); card.addEventListener('touchstart', start); window.addEventListener('mousemove', move); window.addEventListener('touchmove', move); window.addEventListener('mouseup', end); window.addEventListener('touchend', end); } }
    </script>
</body>
</html>
